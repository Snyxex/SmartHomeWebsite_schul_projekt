<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Balkendiagramm mit Chart.js</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script defer>
async function fetchData() {
  try {
    const response = await fetch('/fetch-data');
    const data = await response.json();
    console.log('Fetched data:', data); // Log the fetched data
    updateChart(data);
  } catch (error) {
    console.error('Error fetching data:', error);
  }
}

function updateChart(data) {
  const ctx = document.getElementById('myChart').getContext('2d');

  // Sort data by id in descending order to get the latest entries first
  const sortedData = data.sort((a, b) => b.id - a.id);

  // Slice to get the latest 10 entries
  const latestData = sortedData.slice(sortedData.length - 10, sortedData.length);

  // Reverse the order to display the most recent data last
  latestData.reverse();

  // Extract temperatures and first 10 characters of the timestamp as labels
  const labels = latestData.map(item => {
    const timestamp = item.timestamp ? item.timestamp.substring(2, 10) : '';
    console.log(timestamp) // Get first 10 characters of timestamp
    return `${timestamp}`;
  });
  
  const temperatureData = latestData.map(item => item.temperature);

  // Debugging logs
  console.log('Labels:', labels);
  console.log('Temperature Data:', temperatureData);

  // Chart.js datasets
  const temperatureDataset = {
    label: 'Temperatur',
    data: temperatureData,
    backgroundColor: 'rgba(0, 178, 255, 0.8)', // Background color of the bars
    borderColor: 'rgba(0, 178, 255, 0.8)',// Border color of the bars
    borderWidth: 1
  };

  // Initialize Chart.js
  const myChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [temperatureDataset]
    },
    options: {
      scales: {
        x: {
          stacked: true // Stacked bar chart
        },
        y: {
          beginAtZero: true
        }
      }
    }
  });

  // Log the chart instance to verify if it's created correctly
  console.log('Chart instance:', myChart);
}

// Trigger the data fetch when the document is fully loaded
document.addEventListener('DOMContentLoaded', fetchData);



function getbutton(){
  console.log("true");
turnOn,style.backgroundColor = 'pink';
}
document.getElementById("turnOn").onclick = getbutton;
</script>


<style>

      body{
        font-family: 'Lato', sans-serif;

        background: rgb(255,255,255);
        background: linear-gradient(0deg, rgba(255,255,255,1) 22%, rgba(0,0,0,1) 76%, rgba(0,0,0,1) 92%);
        
      }
      .h1{
        text-decoration: underline;
        color: white;
        font-weight: 80;
      }
      .h2{
        color: white;
        text-align: center;
        text-decoration: underline;
        font-weight: 60;
        font-size: xx-large;
      }
      .button{
        color: black;
        background-color: white;
        border: solid,1cm,1cm, black;
        border-radius: 1em;
        font-weight: 20;
      }
</style>
</head>
<body>

  <nav>
    <button id="turnOn" class="button">An</button>
    <button id="turnOff" class="button">Aus</button>
  </nav>

    <h1 class="h1">Smarte Ãœberwachung</h1>
    <h2 class="h2">Temperatur</h2>
    <canvas id="myChart" width="100" height="50"></canvas>

</body>
</html>
